<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fugth AI Anvil | The Future of AI Companions</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <style>
        :root {
            /* Modern Cyber Theme */
            --color-background: #010409;
            --color-surface: #0d1117;
            --color-surface-light: #161b22;
            --color-border: rgba(217, 249, 157, 0.1);
            --color-primary: #d9f99d; /* Cyber Lime */
            --color-secondary: #7ee787; /* Green */
            --color-text-primary: #e6edf3;
            --color-text-secondary: #7d8590;
            --color-text-heading: #ffffff;
            --color-favorite: #facc15;
            --font-family: 'Inter', sans-serif;
            --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 20px 25px -5px rgba(0,0,0,0.2), 0 8px 10px -6px rgba(0,0,0,0.2);
            
            /* AI Customization Variables */
            --ai-body-color: #d9f99d;
            --ai-eye-color: #010409;
        }

        /* Animations */
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(217, 249, 157, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(217, 249, 157, 0); } 100% { box-shadow: 0 0 0 0 rgba(217, 249, 157, 0); } }
        @keyframes breathe { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.02); } }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* General & Theme Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { 
            font-family: var(--font-family); 
            background-color: var(--color-background); 
            color: var(--color-text-primary); 
            line-height: 1.6; 
            -webkit-font-smoothing: antialiased; 
            position: relative;
            overflow-x: hidden;
            background-image:
                linear-gradient(rgba(217, 249, 157, 0.05) 1px, transparent 1px),
                linear-gradient(to right, rgba(217, 249, 157, 0.05) 1px, transparent 1px);
            background-size: 3rem 3rem;
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--color-surface); }
        ::-webkit-scrollbar-thumb { background: var(--color-primary); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--color-secondary); }

        .container { max-width: 1280px; margin: 0 auto; padding: 0 24px; }
        section { padding: 100px 0; border-bottom: 1px solid var(--color-border); position: relative; }
        section:last-of-type { border-bottom: none; }
        
        h1, h2, h3 { font-weight: 700; line-height: 1.2; color: var(--color-text-heading); letter-spacing: -0.03em; }
        h1 { font-size: 4rem; } h2 { font-size: 2.5rem; } h3 { font-size: 1.75rem; }
        p { color: var(--color-text-secondary); margin-bottom: 1rem; }
        
        .section-header { text-align: center; max-width: 700px; margin: 0 auto 60px auto; }
        .text-gradient { background: linear-gradient(90deg, var(--color-primary), var(--color-secondary)); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent; }
        .btn { display: inline-block; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: 600; transition: all 0.2s ease; border: 1px solid transparent; cursor: pointer; text-align: center; }
        .btn-primary { background: var(--color-primary); color: #010409; border-color: var(--color-primary); }
        .btn-primary:hover { background: var(--color-secondary); border-color: var(--color-secondary); transform: translateY(-2px); box-shadow: 0 10px 20px -5px rgba(217, 249, 157, 0.2); }
        .btn-secondary { background: transparent; border: 1px solid var(--color-border); color: var(--color-text-primary); }
        .btn-secondary:hover { background: var(--color-primary); border-color: var(--color-primary); color: #010409; }
        .btn-disabled { background: #374151; color: #6B7280; cursor: not-allowed; transform: none !important; box-shadow: none !important; }
        .hidden { display: none !important; }

        header { position: fixed; width: 100%; top: 0; left: 0; z-index: 1000; transition: background 0.3s ease, border-color 0.3s ease; backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border-bottom: 1px solid transparent; }
        header.scrolled { background: rgba(1, 4, 9, 0.7); border-bottom-color: var(--color-border); }
        nav { display: flex; justify-content: space-between; align-items: center; padding: 16px 0; }
        .logo { font-size: 1.5rem; font-weight: 800; text-decoration: none; color: var(--color-text-primary); cursor: pointer; }
        .nav-links { list-style: none; display: flex; gap: 32px; }
        .nav-links a { text-decoration: none; color: var(--color-text-secondary); font-weight: 500; transition: color 0.2s ease; cursor: pointer; padding-bottom: 4px; border-bottom: 2px solid transparent; }
        .nav-links a:hover, .nav-links a.active { color: var(--color-primary); border-bottom-color: var(--color-primary); }
        .auth-container { display: flex; align-items: center; gap: 12px; }
        
        .avatar-display { width: 32px; height: 32px; position: relative; }
        .avatar-display .avatar-base { width: 100%; height: 100%; border-radius: 50%; overflow: hidden; display: flex; align-items: center; justify-content: center; background-color: var(--color-surface-light); border: 2px solid var(--color-primary); }
        .avatar-display .avatar-base img { width: 100%; height: 100%; object-fit: cover; }
        .avatar-display .avatar-base i { font-size: 1.2rem; color: var(--color-primary); }

        #hero-page { min-height: 100vh; display: flex; align-items: center; text-align: center; padding-top: 80px; }
        .hero-content { max-width: 800px; margin: 0 auto; }

        .grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1.5rem; }
        .market-card { background: var(--color-surface); border: 1px solid var(--color-border); border-radius: 12px; overflow: hidden; transition: all 0.3s ease; display: flex; flex-direction: column; position: relative;}
        .market-card:hover { transform: translateY(-8px); border-color: var(--color-primary); box-shadow: 0 0 30px rgba(217, 249, 157, 0.1); }
        .market-card.equipped { border-color: var(--color-secondary); box-shadow: 0 0 15px rgba(126, 231, 135, 0.2); }
        .card-image { height: 160px; display: flex; align-items: center; justify-content: center; font-size: 3rem; background: var(--color-background); color: var(--color-primary); }
        .card-content { padding: 1rem; flex-grow: 1; }
        .card-title { font-size: 1.1rem; font-weight: 600; color: var(--color-text-primary); margin-bottom: 0.25rem; }
        .card-footer { display: flex; justify-content: space-between; align-items: center; padding: 0 1rem 1rem 1rem; font-size: 1rem; font-weight: 600; }
        .favorite-btn { font-size: 1.2rem; color: var(--color-text-secondary); cursor: pointer; transition: color 0.2s, transform 0.2s; position: absolute; top: 12px; right: 12px; background: rgba(1,4,9,0.5); padding: 6px; border-radius: 50%; }
        .favorite-btn:hover { color: var(--color-favorite); transform: scale(1.1); }
        .favorite-btn.favorited { color: var(--color-favorite); }

        /* Features Showcase (Interactive Demo) */
        .feature-card { background: var(--color-surface); border: 1px solid var(--color-border); border-radius: 16px; padding: 2rem; transition: all 0.3s ease; position: relative; overflow: hidden; display: flex; flex-direction: column; }
        .feature-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-lg); border-color: var(--color-primary); }
        .feature-icon { width: 50px; height: 50px; background: var(--color-surface-light); border: 1px solid var(--color-border); border-radius: 12px; display: flex; align-items: center; justify-content: center; margin-bottom: 1.5rem; font-size: 1.5rem; color: var(--color-primary); flex-shrink: 0; }
        .feature-card h3 { margin-bottom: 0.75rem; }
        .feature-placeholder { margin-top: 1rem; padding: 1rem; background: var(--color-background); border-radius: 8px; min-height: 100px; display: flex; flex-direction: column; gap: 1rem; justify-content: center; }
        .slider-demo { display: flex; flex-direction: column; gap: 0.5rem; }
        .slider-demo label { color: var(--color-text-secondary); font-size: 0.9rem; }
        input[type="range"] { -webkit-appearance: none; appearance: none; width: 100%; height: 4px; background: var(--color-surface-light); border-radius: 2px; outline: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 16px; height: 16px; background: var(--color-primary); border-radius: 50%; cursor: pointer; }
        .gallery-demo { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; }
        .gallery-item { aspect-ratio: 1 / 1; border: 1px solid var(--color-border); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; color: var(--color-primary); cursor: pointer; transition: all 0.2s; }
        .gallery-item:hover { background: var(--color-surface-light); transform: scale(1.05); }
        .chat-demo { display: flex; flex-direction: column; gap: 0.5rem; }
        .chat-bubble { padding: 0.5rem 1rem; border-radius: 12px; max-width: 80%; }
        .chat-bubble.user { background: var(--color-primary); color: var(--color-background); align-self: flex-end; border-bottom-right-radius: 2px; }
        .chat-bubble.ai { background: var(--color-surface-light); align-self: flex-start; border-bottom-left-radius: 2px; }
        .skills-demo { display: flex; flex-wrap: wrap; gap: 0.75rem; }
        .skill-chip { background: var(--color-surface-light); padding: 0.5rem 1rem; border: 1px solid var(--color-border); border-radius: 20px; font-size: 0.9rem; }
        
        /* Modal */
        .modal-container { background: rgba(1, 4, 9, 0.5); backdrop-filter: blur(8px); }
        .modal-content { background: var(--color-surface); border: 1px solid var(--color-border); }
        .modal-close { background: var(--color-surface-light); }
        .auth-form input { background: var(--color-background); }
        
        /* Profile Page */
        .profile-content { display: grid; grid-template-columns: 300px 1fr; gap: 2rem; margin-top: 2rem; align-items: start; }
        @media (max-width: 992px) { .profile-content { grid-template-columns: 1fr; } }
        .profile-sidebar { background: var(--color-surface); border-radius: 12px; padding: 2rem; border: 1px solid var(--color-border); position: sticky; top: 100px; }
        #profile-avatar-wrapper { width: 150px; height: 150px; margin: 0 auto 1rem; position: relative; }
        #profile-avatar-wrapper .avatar-display { width: 100%; height: 100%; }
        #profile-avatar-wrapper .avatar-display .avatar-base { font-size: 6rem; }
        .avatar-change-btn { position: absolute; bottom: 0; right: 0; width: 36px; height: 36px; border-radius: 50%; background: var(--color-primary); border: none; color: #010409; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; font-size: 1rem; }
        .profile-stats { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin: 2rem 0; }
        .stat-value { font-size: 1.5rem; font-weight: 700; color: var(--color-text-primary); }
        .stat-label { font-size: 0.875rem; color: var(--color-text-secondary); }
        .profile-main { display: flex; flex-direction: column; gap: 2rem; }
        .profile-section { background: var(--color-surface); border-radius: 12px; padding: 2rem; border: 1px solid var(--color-border); }
        .form-group input { padding: 0.75rem; border-radius: 6px; border: 1px solid var(--color-border); background: var(--color-surface-light); color: var(--color-text-primary); font-size: 1rem; }

        /* FLOATING AI STYLES */
        #floating-ai-container { position: fixed; z-index: 1001; width: 70px; height: 70px; cursor: grab; transition: top 0.1s linear, left 0.1s linear; display: flex; align-items: center; justify-content: center; }
        #floating-ai-container.idle { animation: breathe 3s ease-in-out infinite; transition: top 2s ease-in-out, left 2s ease-in-out; }
        #floating-ai-container:active { cursor: grabbing; animation: none; transition: none; }
        .ai-body { width: 100%; height: 100%; background: var(--ai-body-color); border-radius: 50%; box-shadow: inset 0 -5px 15px rgba(0,0,0,0.2), 0 5px 15px rgba(0,0,0,0.3); position: relative; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; }
        .ai-body.icon-skin { background: transparent; box-shadow: none; font-size: 50px; color: var(--ai-body-color); text-shadow: 0 0 10px var(--ai-body-color); }
        .ai-face { width: 60%; height: 60%; position: relative; }
        .ai-eye { position: absolute; top: 20%; width: 12px; height: 12px; background: var(--ai-eye-color); border-radius: 50%; box-shadow: inset 0 2px 5px rgba(0,0,0,0.3); transition: all 0.2s ease; }
        .ai-eye-left { left: 15%; }
        .ai-eye-right { right: 15%; }
        .ai-mouth { position: absolute; bottom: 15%; left: 50%; transform: translateX(-50%); width: 20px; height: 10px; border: 2px solid var(--ai-eye-color); border-top: none; border-radius: 0 0 10px 10px; transition: all 0.2s ease; }
        .ai-face.happy .ai-mouth { height: 15px; border-radius: 0 0 15px 15px; }
        .ai-face.annoyed .ai-eye { height: 4px; top: 40%; border-radius: 2px; transform: rotate(-15deg); }
        .ai-face.annoyed .ai-eye-right { transform: rotate(15deg); }
        .ai-face.annoyed .ai-mouth { width: 15px; height: 5px; border: 2px solid var(--ai-eye-color); border-radius: 5px; border-top-left-radius: 0; border-top-right-radius: 0; }
        .ai-face.blinking .ai-eye { transform: scaleY(0.1); height: 8px; }

        /* Customization Panel */
        #customization-panel { position: fixed; z-index: 2500; width: 280px; background: rgba(13, 17, 23, 0.7); border: 1px solid var(--color-border); border-radius: 12px; box-shadow: var(--shadow-lg); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); visibility: hidden; opacity: 0; transform: scale(0.95); transition: all 0.3s ease; top: 50%; left: 50%; }
        #customization-panel.show { visibility: visible; opacity: 1; transform: scale(1); }
        .panel-header { padding: 12px; border-bottom: 1px solid var(--color-border); display: flex; justify-content: space-between; align-items: center; cursor: grab; }
        .panel-header h4 { font-weight: 600; color: var(--color-primary); }
        .panel-header:active { cursor: grabbing; }
        .panel-close-btn { cursor: pointer; color: var(--color-text-secondary); width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; border-radius: 50%; }
        .panel-close-btn:hover { background: var(--color-surface-light); color: var(--color-text-primary); }
        .panel-body { padding: 16px; display: flex; flex-direction: column; gap: 16px; }
        .control-group { display: flex; flex-direction: column; gap: 8px; }
        .control-group label { font-size: 0.9rem; color: var(--color-text-secondary); }
        .control-group .shape-buttons, .control-group .expression-buttons { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .control-btn { padding: 8px; font-size: 1.2rem; }
        input[type="color"] { -webkit-appearance: none; -moz-appearance: none; appearance: none; width: 100%; height: 30px; background-color: transparent; border: 1px solid var(--color-border); border-radius: 6px; cursor: pointer; }
        input[type="color"]::-webkit-color-swatch { border: none; border-radius: 5px; }

        .user-status { font-weight: 500; display: flex; align-items: center; gap: 8px; cursor: pointer; }
        #toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 3000; }
        .toast { padding: 12px 20px; border-radius: 8px; color: #fff; margin-top: 10px; opacity: 0; transform: translateY(20px); transition: all 0.4s ease; background-color: var(--color-surface-light); border: 1px solid var(--color-border); box-shadow: var(--shadow-md); }
        .toast.show { opacity: 1; transform: translateY(0); }
        .loader-container { width: 100%; display: flex; justify-content: center; padding: 4rem; }
        .loader { width: 40px; height: 40px; border: 4px solid var(--color-border); border-top-color: var(--color-primary); border-radius: 50%; animation: spin 1s linear infinite; }
        #radial-menu-container { position: fixed; z-index: 1002; width: 220px; height: 220px; visibility: hidden; opacity: 0; transition: opacity 0.3s ease, visibility 0.3s ease, transform 0.3s ease; transform: translate(-50%, -50%) scale(0.8); pointer-events: none; }
        #radial-menu-container.show { visibility: visible; opacity: 1; transform: translate(-50%, -50%) scale(1); pointer-events: auto; }
        .radial-button { position: absolute; top: 50%; left: 50%; width: 50px; height: 50px; background: rgba(1, 4, 9, 0.7); color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; border: 1px solid var(--color-border); backdrop-filter: blur(10px); cursor: pointer; transition: all 0.2s ease; margin-left: -25px; margin-top: -25px; }
        .radial-button:hover { background: var(--color-primary); color: #010409;}

        /* Responsive */
        @media (max-width: 992px) {
            h1 { font-size: 3rem; } h2 { font-size: 2rem; }
            .mobile-menu-toggle { display: flex; flex-direction: column; justify-content: space-around; width: 30px; height: 25px; background: transparent; border: none; cursor: pointer; z-index: 1000; }
            .mobile-menu-toggle span { width: 100%; height: 2px; background: var(--color-text-primary); transition: all 0.3s ease; }
            .mobile-menu-toggle.active span:nth-child(1) { transform: translateY(8px) rotate(45deg); }
            .mobile-menu-toggle.active span:nth-child(2) { opacity: 0; }
            .mobile-menu-toggle.active span:nth-child(3) { transform: translateY(-8px) rotate(-45deg); }
            .nav-links { position: fixed; top: 0; right: -100%; height: 100vh; width: 80%; max-width: 400px; background: var(--color-surface); flex-direction: column; padding: 80px 2rem; transition: right 0.3s ease; box-shadow: var(--shadow-lg); z-index: 999; }
            .nav-links.active { right: 0; }
        }
    </style>
</head>
<body>
    <div id="modal-container" class="modal-container"></div>
    <div id="toast-container"></div>

    <header id="main-header">
        <div class="container">
            <nav>
                <a class="logo nav-link" data-target="hero-page"><i class="fa-solid fa-bolt"></i> Anvil</a>
                <button class="mobile-menu-toggle" id="mobile-menu-toggle"><span></span><span></span><span></span></button>
                <ul class="nav-links">
                    <li><a class="nav-link" data-target="features-showcase">Features</a></li>
                    <li><a class="nav-link" data-target="marketplace-page">Marketplace</a></li>
                    <li><a class="nav-link hidden" data-target="inventory-page" id="inventory-nav-link">My Inventory</a></li>
                    <li><a class="nav-link hidden" data-target="profile-page" id="profile-nav-link">Profile</a></li>
                </ul>
                <div class="auth-container">
                    <div class="user-status" id="user-status-container"></div>
                    <a href="#" id="auth-button" class="btn btn-secondary">Login</a>
                </div>
            </nav>
        </div>
    </header>

    <main>
        <section id="hero-page">
             <div class="container">
                <div class="hero-content" data-aos="fade-up">
                    <h1>Your Personal <span class="text-gradient">AI Companion</span>, Forged by You.</h1>
                    <p class="subtitle">Anvil is a powerful desktop application that lets you build, customize, and interact with a truly personal AI. Go beyond assistants—create a personality.</p>
                    <a href="#" class="btn btn-primary pulse-button">Get Anvil - $99.99</a>
                </div>
            </div>
        </section>

        <section id="features-showcase">
             <div class="container">
                <div class="section-header" data-aos="fade-up">
                    <h2>The <span class="text-gradient">Anvil Forge</span></h2>
                    <p>Powered by GGUF technology, Anvil gives you unprecedented control. Don't just read about it—try the interactive demos below.</p>
                </div>
                <div class="features-grid">
                    <div class="feature-card" data-aos="fade-up" data-aos-delay="100">
                        <div class="feature-icon"><i class="fas fa-sliders-h"></i></div>
                        <h3>The Personality Forge</h3>
                        <div class="feature-placeholder">
                            <div class="slider-demo"><label>Humor</label><input type="range" min="0" max="100" value="75"></div>
                            <div class="slider-demo"><label>Sarcasm</label><input type="range" min="0" max="100" value="30"></div>
                        </div>
                    </div>
                    <div class="feature-card" data-aos="fade-up" data-aos-delay="200">
                        <div class="feature-icon"><i class="fas fa-palette"></i></div>
                        <h3>Visual Anvil</h3>
                        <div class="feature-placeholder">
                            <div class="gallery-demo">
                                <div class="gallery-item"><i class="fas fa-ghost"></i></div>
                                <div class="gallery-item"><i class="fas fa-fire"></i></div>
                                <div class="gallery-item"><i class="fas fa-robot"></i></div>
                            </div>
                        </div>
                    </div>
                     <div class="feature-card" data-aos="fade-up" data-aos-delay="300">
                        <div class="feature-icon"><i class="fas fa-brain"></i></div>
                        <h3>Persistent Memory</h3>
                        <div class="feature-placeholder">
                           <div class="chat-demo">
                                <div class="chat-bubble user">I like space exploration.</div>
                                <div class="chat-bubble ai">Noted. I'll remember that.</div>
                           </div>
                        </div>
                    </div>
                     <div class="feature-card" data-aos="fade-up" data-aos-delay="400">
                        <div class="feature-icon"><i class="fas fa-cogs"></i></div>
                        <h3>Extensible Skills</h3>
                        <div class="feature-placeholder">
                            <div class="skills-demo">
                                <div class="skill-chip"><i class="fas fa-code"></i> Code Interpreter</div>
                                <div class="skill-chip"><i class="fas fa-globe"></i> Web Search</div>
                                <div class="skill-chip"><i class="fas fa-calendar"></i> Calendar</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <section id="marketplace-page" class="hidden">
            <div class="container">
                <div class="section-header" data-aos="fade-up">
                    <h2>The <span class="text-gradient">Marketplace</span></h2>
                    <p>Discover unique personalities, skins, and tools for your AI, crafted by the community and our studio.</p>
                </div>
                <div class="page-content"><div class="grid-container" id="market-grid-container"></div></div>
            </div>
        </section>

        <section id="inventory-page" class="hidden">
             <div class="container">
                  <div class="section-header" data-aos="fade-up">
                        <h2>My <span class="text-gradient">Inventory</span></h2>
                        <p>All of your acquired items in one place. Equip skins and accessories to customize your AI's appearance.</p>
                  </div>
                  <div class="page-content"><div class="grid-container" id="inventory-grid-container"></div></div>
             </div>
        </section>
        
        <section id="profile-page" class="hidden">
            <div class="container">
                <div class="profile-content" data-aos="fade-up">
                    <div class="profile-sidebar">
                        <div style="text-align:center;">
                             <div id="profile-avatar-wrapper"></div>
                            <button class="avatar-change-btn" title="Change Avatar" id="avatarChangeBtn"><i class="fas fa-user-edit"></i></button>
                            <h3 id="profileDisplayName">User Name</h3>
                            <p id="profileEmail">user@example.com</p>
                        </div>
                        <div class="profile-stats">
                            <div class="stat-item"><div class="stat-value" id="totalTokens">0</div><div class="stat-label">Total Tokens</div></div>
                            <div class="stat-item"><div class="stat-value" id="joinDate">-</div><div class="stat-label">Joined</div></div>
                        </div>
                    </div>
                    <div class="profile-main">
                        <div class="profile-section">
                            <h3>Personal Information</h3>
                            <form id="personalInfoForm"><div class="form-group"><label for="displayName">Display Name</label><input type="text" id="displayName"></div><div class="form-group"><label for="email">Email</label><input type="email" id="email" disabled></div><button type="submit" class="btn btn-primary">Save Changes</button></form>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <div id="floating-ai-container">
        <div class="ai-body">
            <div class="ai-face"><div class="ai-eye ai-eye-left"></div><div class="ai-eye ai-eye-right"></div><div class="ai-mouth"></div></div>
        </div>
    </div>

    <div id="radial-menu-container"></div>

    <div id="customization-panel">
        <div class="panel-header" id="panel-header"><h4>Live Customizer</h4><div class="panel-close-btn" id="panel-close-btn"><i class="fas fa-times"></i></div></div>
        <div class="panel-body">
            <div class="control-group"><label for="ai-color-picker">Color</label><input type="color" id="ai-color-picker" value="#d9f99d"></div>
            <div class="control-group"><label for="ai-size-slider">Size</label><input type="range" id="ai-size-slider" min="50" max="150" value="70"></div>
            <div class="control-group">
                <label>Shape Override</label>
                <div class="shape-buttons">
                    <button class="btn btn-secondary control-btn" data-shape="default"><i class="fas fa-user"></i></button>
                    <button class="btn btn-secondary control-btn" data-shape="fa-star"><i class="fas fa-star"></i></button>
                    <button class="btn btn-secondary control-btn" data-shape="fa-heart"><i class="fas fa-heart"></i></button>
                    <button class="btn btn-secondary control-btn" data-shape="fa-square"><i class="fas fa-square"></i></button>
                </div>
            </div>
            <div class="control-group">
                <label>Expressions</label>
                <div class="expression-buttons">
                    <button class="btn btn-secondary control-btn" data-face="happy"><i class="fas fa-smile"></i></button>
                    <button class="btn btn-secondary control-btn" data-face="annoyed"><i class="fas fa-angry"></i></button>
                    <button class="btn btn-secondary control-btn" data-face="blinking"><i class="fas fa-minus"></i></button>
                    <button class="btn btn-secondary control-btn" data-face="neutral"><i class="fas fa-meh"></i></button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script>
    'use strict';
    document.addEventListener('DOMContentLoaded', () => {
        // --- INITIALIZATION & GLOBAL STATE ---
        AOS.init({ duration: 800, once: true, offset: 50 });

        const firebaseConfig = {
            apiKey: "AIzaSyBlqTqN1gUoCpuqPqmpLdtZdJHVFbTWyTs",
            authDomain: "fugthdesign-91744.firebaseapp.com",
            projectId: "fugthdesign-91744",
            storageBucket: "fugthdesign-91744.appspot.com",
            messagingSenderId: "797596632132",
            appId: "1:797596632132:web:2c2ebfa54c908e09a26811"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        let currentUser = null;
        let userInventory = new Map();
        let allProductsCache = new Map();
        let equippedItems = { skin: null };

        // --- ELEMENT REFERENCES ---
        const authButton = document.getElementById('auth-button');
        const userStatusContainer = document.getElementById('user-status-container');
        const marketGrid = document.getElementById('market-grid-container');
        const inventoryGrid = document.getElementById('inventory-grid-container');
        const modalContainer = document.getElementById('modal-container');
        const inventoryNavLink = document.getElementById('inventory-nav-link');
        const profileNavLink = document.getElementById('profile-nav-link');
        const navLinks = document.querySelectorAll('.nav-link');
        const header = document.getElementById('main-header');
        
        // --- FLOATING AI & PANEL REFERENCES ---
        const aiContainer = document.getElementById('floating-ai-container');
        const aiBody = aiContainer.querySelector('.ai-body');
        const radialMenu = document.getElementById('radial-menu-container');
        const customPanel = document.getElementById('customization-panel');

        // --- FLOATING AI & PANEL ---
        let isDragging = false, isPanelDragging = false;
        let offsetX, offsetY, panelOffsetX, panelOffsetY;
        let moveTimeout, inactivityTimer, annoyanceInterval;
        let lastInteractionTime = Date.now();
        let isAnnoying = false;
        let mouseX = window.innerWidth / 2, mouseY = window.innerHeight / 2;

        function setAIFace(face) {
            const aiFaceEl = aiContainer.querySelector('.ai-face');
            if (!aiFaceEl) return;
            aiFaceEl.className = 'ai-face'; 
            if (face && face !== 'neutral') aiFaceEl.classList.add(face);
            if (face === 'blinking') setTimeout(() => setAIFace('neutral'), 200);
        }

        function updateFloatingAISkin() {
            if (equippedItems.skin && allProductsCache.has(equippedItems.skin)) {
                const skinProduct = allProductsCache.get(equippedItems.skin);
                aiBody.classList.add('icon-skin');
                aiBody.innerHTML = `<i class="fa-solid ${skinProduct.icon}"></i>`;
            } else {
                aiBody.classList.remove('icon-skin');
                if (!aiBody.querySelector('.ai-face')) {
                    aiBody.innerHTML = `<div class="ai-face"><div class="ai-eye ai-eye-left"></div><div class="ai-eye ai-eye-right"></div><div class="ai-mouth"></div></div>`;
                }
            }
        }
        
        // Drag logic for AI
        const startDrag = (e) => { isDragging = true; aiContainer.classList.remove('idle'); clearTimeout(moveTimeout); offsetX = e.clientX - aiContainer.offsetLeft; offsetY = e.clientY - aiContainer.offsetTop; document.addEventListener('mousemove', dragMove); document.addEventListener('mouseup', dragEnd); };
        const dragMove = (e) => { if (!isDragging) return; aiContainer.style.left = `${e.clientX - offsetX}px`; aiContainer.style.top = `${e.clientY - offsetY}px`; if (radialMenu.classList.contains('show')) updateRadialMenuPosition(); }; // <-- FIX for sticky menu
        const dragEnd = () => { isDragging = false; aiContainer.classList.add('idle'); document.removeEventListener('mousemove', dragMove); document.removeEventListener('mouseup', dragEnd); scheduleNextMove(); };
        aiContainer.addEventListener('mousedown', startDrag);

        // Annoyance Logic
        function resetInteractionTimer() { lastInteractionTime = Date.now(); }
        document.addEventListener('mousemove', e => { mouseX = e.clientX; mouseY = e.clientY; resetInteractionTimer(); });
        document.addEventListener('click', resetInteractionTimer);
        function startAnnoyanceCheck() { if (inactivityTimer) clearInterval(inactivityTimer); inactivityTimer = setInterval(() => { if (Date.now() - lastInteractionTime > 15000 && !isAnnoying && !isDragging && !radialMenu.classList.contains('show') && !customPanel.classList.contains('show')) beginAnnoying(); }, 2000); }
        function beginAnnoying() { isAnnoying = true; clearInterval(inactivityTimer); clearTimeout(moveTimeout); aiContainer.classList.remove('idle'); setAIFace('annoyed'); annoyanceInterval = setInterval(() => { const rect = aiContainer.getBoundingClientRect(); aiContainer.style.left = `${rect.left + (mouseX - rect.left - rect.width/2) * 0.08}px`; aiContainer.style.top = `${rect.top + (mouseY - rect.top - rect.height/2) * 0.08}px`; }, 30); }
        function stopAnnoying() { isAnnoying = false; clearInterval(annoyanceInterval); aiContainer.classList.add('idle'); setAIFace('happy'); setTimeout(() => { setAIFace('neutral'); scheduleNextMove(); startAnnoyanceCheck(); }, 2000); }

        // Radial Menu & Customizer Panel Logic
        aiContainer.addEventListener('click', (e) => { if(isDragging) return; if(isAnnoying) { stopAnnoying(); return; } toggleRadialMenu(e); });
        function toggleRadialMenu() { radialMenu.classList.toggle('show'); if (radialMenu.classList.contains('show')) updateRadialMenuPosition(); }
        function updateRadialMenuPosition() { const rect = aiContainer.getBoundingClientRect(); radialMenu.style.left = `${rect.left + rect.width / 2}px`; radialMenu.style.top = `${rect.top + rect.height / 2}px`; radialMenu.querySelectorAll('.radial-button').forEach((btn, i, arr) => { const angle = (i * (360 / arr.length) - 90) * (Math.PI / 180); btn.style.transform = `translate(${80 * Math.cos(angle)}px, ${80 * Math.sin(angle)}px)`; }); }
        function createRadialMenu() { radialMenu.innerHTML = ''; [{ icon: 'fa-comments', action: () => showToast('Chat coming soon!') }, { icon: 'fa-palette', action: () => { customPanel.classList.add('show'); radialMenu.classList.remove('show'); clearTimeout(moveTimeout); } }].forEach(item => { const btn = document.createElement('div'); btn.className = 'radial-button'; btn.innerHTML = `<i class="fas ${item.icon}"></i>`; btn.addEventListener('click', item.action); radialMenu.appendChild(btn); }); }
        
        // Customization Panel Controls
        document.getElementById('panel-close-btn').addEventListener('click', () => { customPanel.classList.remove('show'); scheduleNextMove(); });
        document.getElementById('ai-color-picker').addEventListener('input', (e) => document.documentElement.style.setProperty('--ai-body-color', e.target.value));
        document.getElementById('ai-size-slider').addEventListener('input', (e) => { aiContainer.style.width = `${e.target.value}px`; aiContainer.style.height = `${e.target.value}px`; });
        document.querySelectorAll('.shape-btn').forEach(btn => btn.addEventListener('click', (e) => { const shape = e.currentTarget.dataset.shape; if(shape === 'default') updateFloatingAISkin(); else { aiBody.classList.add('icon-skin'); aiBody.innerHTML = `<i class="fa-solid ${shape}"></i>`; } }));
        document.querySelectorAll('.expression-btn').forEach(btn => btn.addEventListener('click', (e) => setAIFace(e.currentTarget.dataset.face)));

        // Panel Draggability
        const panelHeader = document.getElementById('panel-header');
        panelHeader.addEventListener('mousedown', (e) => { isPanelDragging = true; panelOffsetX = e.clientX - customPanel.offsetLeft; panelOffsetY = e.clientY - customPanel.offsetTop; });
        document.addEventListener('mousemove', (e) => { if (isPanelDragging) { customPanel.style.left = `${e.clientX - panelOffsetX}px`; customPanel.style.top = `${e.clientY - panelOffsetY}px`; } });
        document.addEventListener('mouseup', () => { isPanelDragging = false; });
        
        const scheduleNextMove = () => { clearTimeout(moveTimeout); if (customPanel.classList.contains('show') || isAnnoying || isDragging) return; moveTimeout = setTimeout(() => { const maxX = window.innerWidth - aiContainer.clientWidth; const maxY = window.innerHeight - aiContainer.clientHeight; aiContainer.style.left = `${Math.random() * maxX}px`; aiContainer.style.top = `${Math.random() * maxY}px`; scheduleNextMove(); }, 8000); };
        
        // --- FIREBASE & DATA ---
        async function initializeApp() { renderLoader(marketGrid); await fetchAllProducts(); auth.onAuthStateChanged(handleAuthStateChange); switchToPage('hero-page'); }
        async function handleAuthStateChange(user) { if (user) { currentUser = user; await onLogin(); } else { currentUser = null; onLogout(); } }
        async function onLogin() { updateNavForLoggedInUser(); await fetchEquippedItems(); await fetchUserInventory(); updateAvatarDisplay(); updateFloatingAISkin(); updateProfilePageUI(); filterAndRenderProducts(); }
        function onLogout() { updateUIForLoggedOutUser(); filterAndRenderProducts(); }
        async function fetchAllProducts() { const snapshot = await db.collection('products').get(); if (snapshot.empty) { await seedDefaultProducts(); await fetchAllProducts(); } else { snapshot.forEach(doc => allProductsCache.set(doc.id, { id: doc.id, ...doc.data() })); } }
        async function fetchUserInventory() { if (!currentUser) return; userInventory.clear(); const snapshot = await db.collection('user_inventory').doc(currentUser.uid).collection('items').get(); snapshot.forEach(doc => userInventory.set(doc.id, doc.data())); }
        async function fetchEquippedItems() { if (!currentUser) { equippedItems = { skin: null }; return; }; const doc = await db.collection('users').doc(currentUser.uid).collection('settings').doc('avatar').get(); equippedItems = doc.exists ? { skin: doc.data().skin || null } : { skin: null }; }
        
        // --- UI RENDERING & MANAGEMENT ---
        function renderLoader(container) { if(container) container.innerHTML = '<div class="loader-container"><div class="loader"></div></div>'; }
        function showToast(message) { const toast = document.createElement('div'); toast.className = 'toast'; toast.textContent = message; document.getElementById('toast-container').appendChild(toast); setTimeout(() => toast.classList.add('show'), 10); setTimeout(() => { toast.classList.remove('show'); setTimeout(() => toast.remove(), 500); }, 3000); }
        function switchToPage(pageId) { document.querySelectorAll('main section').forEach(sec => sec.classList.add('hidden')); const targetPage = document.getElementById(pageId); if(targetPage) { targetPage.classList.remove('hidden'); AOS.refresh(); } navLinks.forEach(link => link.classList.toggle('active', link.dataset.target === pageId)); window.scrollTo(0, 0); }
        function updateNavForLoggedInUser() { authButton.textContent = 'Logout'; inventoryNavLink.classList.remove('hidden'); profileNavLink.classList.remove('hidden'); const name = currentUser.displayName || currentUser.email.split('@')[0]; userStatusContainer.innerHTML = `<div class="avatar-display"><div class="avatar-base"><img src="${currentUser.photoURL || `https://api.dicebear.com/6.x/pixel-art/svg?seed=${encodeURIComponent(name)}`}" alt="Avatar"></div></div><span>${name}</span>`; }
        function updateUIForLoggedOutUser() { userStatusContainer.innerHTML = ''; authButton.textContent = 'Login'; inventoryNavLink.classList.add('hidden'); profileNavLink.classList.add('hidden'); userInventory.clear(); equippedItems = { skin: null }; updateFloatingAISkin(); switchToPage('hero-page'); }
        function updateAvatarDisplay() { if (!currentUser) return; const name = currentUser.displayName || currentUser.email.split('@')[0]; const baseAvatarUrl = currentUser.photoURL || `https://api.dicebear.com/6.x/pixel-art/svg?seed=${encodeURIComponent(name)}`; let avatarBaseHtml; if (equippedItems.skin) { const skinProduct = allProductsCache.get(equippedItems.skin); avatarBaseHtml = `<div class="avatar-base"><i class="fa-solid fa-${skinProduct?.icon || 'question'}"></i></div>`; } else { avatarBaseHtml = `<div class="avatar-base"><img src="${baseAvatarUrl}" alt="User Avatar"></div>`; } const fullAvatarHtml = `<div class="avatar-display">${avatarBaseHtml}</div>`; userStatusContainer.innerHTML = `${fullAvatarHtml}<span>${name}</span>`; if (document.getElementById('profile-avatar-wrapper')) { document.getElementById('profile-avatar-wrapper').innerHTML = fullAvatarHtml; } }
        function updateProfilePageUI() { if (!currentUser) return; updateAvatarDisplay(); document.getElementById('profileDisplayName').textContent = currentUser.displayName; document.getElementById('profileEmail').textContent = currentUser.email; document.getElementById('displayName').value = currentUser.displayName; document.getElementById('email').value = currentUser.email; }
        
        // --- MODALS (Login, Signup, Product) ---
        function openAuthModal(showSignup = false) { const loginHidden = showSignup ? 'hidden' : ''; const signupHidden = !showSignup ? 'hidden' : ''; const html = `<div class="modal-content modal-auth"><div class="modal-close"><i class="fa-solid fa-times"></i></div><div id="login-view" class="${loginHidden}"><h3>Login</h3><form id="login-form" class="auth-form"><p class="form-error" style="color:red; text-align:center;"></p><input type="email" name="email" placeholder="Email" required><input type="password" name="password" placeholder="Password" required><button type="submit" class="btn btn-primary" style="width:100%;">Login</button></form><p style="text-align:center; margin-top:1rem;">No account? <a href="#" id="show-signup" style="color:var(--color-primary)">Sign Up</a></p></div><div id="signup-view" class="${signupHidden}"><h3>Create Account</h3><form id="signup-form" class="auth-form"><p class="form-error" style="color:red; text-align:center;"></p><input type="email" name="email" placeholder="Email" required><input type="password" name="password" placeholder="Password" required><button type="submit" class="btn btn-primary" style="width:100%;">Create</button></form><p style="text-align:center; margin-top:1rem;">Have an account? <a href="#" id="show-login" style="color:var(--color-primary)">Login</a></p></div></div>`; modalContainer.innerHTML = html; modalContainer.classList.add('show'); modalContainer.querySelector('.modal-close').addEventListener('click', closeModal); document.getElementById('login-form')?.addEventListener('submit', handleLogin); document.getElementById('signup-form')?.addEventListener('submit', handleSignup); document.getElementById('show-signup').addEventListener('click', e => { e.preventDefault(); openAuthModal(true); }); document.getElementById('show-login').addEventListener('click', e => { e.preventDefault(); openAuthModal(false); }); }
        function closeModal() { if(modalContainer) modalContainer.classList.remove('show'); }
        async function handleLogin(e) { e.preventDefault(); try { await auth.signInWithEmailAndPassword(e.target.email.value, e.target.password.value); closeModal(); showToast(`Welcome back!`); } catch (err) { e.target.querySelector('.form-error').textContent = err.message; } }
        async function handleSignup(e) { e.preventDefault(); try { const cred = await auth.createUserWithEmailAndPassword(e.target.email.value, e.target.password.value); await db.collection('users').doc(cred.user.uid).set({ displayName: cred.user.email.split('@')[0], email: cred.user.email, createdAt: firebase.firestore.FieldValue.serverTimestamp() }); closeModal(); showToast(`Welcome!`); } catch (err) { e.target.querySelector('.form-error').textContent = err.message; } }
        
        // --- Marketplace, Inventory, and Item Actions ---
        function filterAndRenderProducts() { if (!marketGrid) return; const products = Array.from(allProductsCache.values()); marketGrid.innerHTML = products.length ? products.map(p => createProductCard(p, 'marketplace')).join('') : `<p>No items found.</p>`; }
        function renderInventory() { if (!inventoryGrid) return; if (userInventory.size === 0) { inventoryGrid.innerHTML = "<p style='text-align: center; grid-column: 1 / -1;'>Inventory is empty.</p>"; return; } const inventoryArray = Array.from(userInventory.keys()).map(id => ({ id, ...allProductsCache.get(id) })).filter(item => item.name); inventoryGrid.innerHTML = inventoryArray.map(product => createProductCard(product, 'inventory')).join(''); }
        function createProductCard(product, context) { if (!product) return ''; const isOwned = userInventory.has(product.id); const isEquipped = equippedItems.skin === product.id; let footerHtml = ''; if (context === 'inventory') { footerHtml = `<button class="btn btn-primary equip-btn" data-product-id="${product.id}">${isEquipped ? 'Unequip' : 'Equip'}</button>`; } else { footerHtml = `<span class="card-price text-gradient">${isOwned ? 'Owned' : (product.price === 0 ? 'Free' : `$${product.price.toFixed(2)}`)}</span>`; } return `<div class="market-card ${isEquipped ? 'equipped' : ''}" data-product-id="${product.id}" data-aos="fade-up"><div class="card-image"><i class="fa-solid fa-${product.icon}"></i></div><div class="card-content"><h4 class="card-title">${product.name}</h4><p class="card-creator">by ${product.creator}</p></div><div class="card-footer">${footerHtml}</div></div>`; }
        async function handleEquipToggle(productId) { if (!currentUser) return; const newSkin = equippedItems.skin === productId ? null : productId; try { await db.collection('users').doc(currentUser.uid).collection('settings').doc('avatar').set({ skin: newSkin }); equippedItems.skin = newSkin; updateFloatingAISkin(); updateAvatarDisplay(); renderInventory(); showToast(`Item ${newSkin ? 'equipped' : 'unequipped'}.`); } catch (error) { showToast("Couldn't save your choice."); } }
        async function seedDefaultProducts() { const prods = [ { name: "Glitch Skin", icon: "fa-ghost", category: "skin", price: 10, creator: "Community Artist" }, { name: "Fire Skin", icon: "fa-fire", category: "skin", price: 0, creator: "Anvil Studios" } ]; const batch = db.batch(); prods.forEach(p => batch.set(db.collection("products").doc(), p)); await batch.commit(); }

        // --- GLOBAL EVENT LISTENERS ---
        navLinks.forEach(link => link.addEventListener('click', (e) => { e.preventDefault(); const targetId = e.currentTarget.dataset.target; if ((targetId.includes('inventory') || targetId.includes('profile')) && !currentUser) { openAuthModal(); return; } if (targetId === 'inventory-page') renderInventory(); switchToPage(targetId); document.querySelector('.nav-links').classList.remove('active'); document.getElementById('mobile-menu-toggle').classList.remove('active'); }));
        window.addEventListener('scroll', () => header.classList.toggle('scrolled', window.scrollY > 50));
        authButton.addEventListener('click', e => { e.preventDefault(); currentUser ? auth.signOut() : openAuthModal(); });
        document.addEventListener('click', e => { if (e.target.closest('.equip-btn')) handleEquipToggle(e.target.closest('.equip-btn').dataset.productId); });

        // --- STARTUP ---
        initializeApp();
        createRadialMenu();
        aiContainer.classList.add('idle');
        scheduleNextMove();
        startAnnoyanceCheck();
    });
    </script>
</body>
</html>
